<h2 class="content-block">Doctor List</h2>
<div class="content-block">
  <div class="dx-card responsive-paddings">
    <dx-button (click)="this.createDoctorPopupVisible = true;" text="Add new Doctor"></dx-button>
    <dx-popup
      [(visible)]="createDoctorPopupVisible"
      [dragEnabled]="false"
      [height]="600"
      [showCloseButton]="true"
      [showTitle]="true"
      [width]="500"
      title="Create new Doctor"
    >
      <div *dxTemplate="let data of 'content'">

        <form (submit)="createDoctor($event)">
          <dx-form [formData]="createDoctorFormData">

            <dxi-item [editorOptions]="{ stylingMode: 'filled', placeholder: 'Username' }" dataField="username" editorType="dxTextBox">
              <dxi-validation-rule message="Username is required" type="required"></dxi-validation-rule>
              <dxo-label [visible]="false"></dxo-label>
            </dxi-item>

            <dxi-item [editorOptions]="{ stylingMode: 'filled', placeholder: 'Email', mode: 'email' }" dataField="email" editorType="dxTextBox">
              <dxi-validation-rule message="Email is required" type="required"></dxi-validation-rule>
              <dxi-validation-rule message="Email is invalid" type="email"></dxi-validation-rule>
              <dxo-label [visible]="false"></dxo-label>
            </dxi-item>

            <dxi-item [editorOptions]="{ stylingMode: 'filled', placeholder: 'Password', mode:'password' }" dataField="password" editorType="dxTextBox">
              <dxi-validation-rule message="Password is required" type="required"></dxi-validation-rule>
              <dxo-label [visible]="false"></dxo-label>
            </dxi-item>

            <!--            todo: add a tagbox with clinics instead -->
            <dxi-item [editorOptions]="{ stylingMode: 'filled', placeholder: 'ClinicId' }" dataField="clinicId" editorType="dxTextBox">
              <dxi-validation-rule message="ClinicId is required" type="required"></dxi-validation-rule>
              <dxo-label [visible]="false"></dxo-label>
            </dxi-item>


            <dxi-item itemType="button">
              <dxo-button-options
                [text]="'Create New Doctor'"
                [useSubmitBehavior]="true"
                type="default"
                width="100%"
              >
              </dxo-button-options>
            </dxi-item>
          </dx-form>
        </form>
      </div>
    </dx-popup>

    <dx-data-grid [columnAutoWidth]="true"
                  [columnHidingEnabled]="true"
                  [dataSource]="dataSource"
                  [focusedRowEnabled]="false"
                  [showBorders]="true"
                  class="dx-card wide-card">

      <dxo-paging [pageSize]="10"></dxo-paging>
      <dxo-pager [showInfo]="true" [showPageSizeSelector]="true"></dxo-pager>
      <dxo-filter-row [visible]="true"></dxo-filter-row>

      <dxi-column [width]="90" caption="ID" dataField="id"></dxi-column>
      <dxi-column caption="Username" dataField="username"></dxi-column>
      <dxi-column caption="Email" dataField="email"></dxi-column>

      <dxi-column caption="Actions" cellTemplate="actionCellTemplate"></dxi-column>

      <div *dxTemplate="let data of 'actionCellTemplate'">
        <!--        Button that opens a dialog for deleting a test type -->
        <dx-button
          (click)="openDeletePopup(data.data.id)"
          text="Delete"
          type="danger"
        ></dx-button>

        <dx-button
          (click)="openUpdatePopup(data.data)"
          text="Update"
          type="normal"
        ></dx-button>
      </div>
    </dx-data-grid>

    <dx-popup
      [(visible)]="deletePopupVisible"
      [dragEnabled]="false"
      [height]="600"
      [showTitle]="true"
      [width]="600"
      title="Delete Doctor">
      <div *dxTemplate="let data of 'content'">
        <p>Are you sure you want to delete this Doctor?</p>
        <dx-button (onClick)="deleteDoctor()" text="Yes"></dx-button>
        <dx-button (onClick)="deletePopupVisible = false" text="No"></dx-button>
      </div>
    </dx-popup>

    <dx-popup
      [(visible)]="updatePopupVisible"
      [dragEnabled]="false"
      [height]="600"
      [showCloseButton]="true"
      [showTitle]="true"
      [width]="500"
      title="Update Doctor"
    >
      <div *dxTemplate="let data of 'content'">

        <form (submit)="updateDoctor($event)">
          <dx-form [formData]="updateDoctorFormData">

            <dxi-item [editorOptions]="{ stylingMode: 'filled', placeholder: selectedDoctor.username }" dataField="username" editorType="dxTextBox">
              <dxi-validation-rule message="Username is required" type="required"></dxi-validation-rule>
              <dxo-label [visible]="false"></dxo-label>
            </dxi-item>


            <dxi-item [editorOptions]="{ stylingMode: 'filled', placeholder: selectedDoctor.email }" dataField="email" editorType="dxTextBox">
              <dxi-validation-rule message="Email is required" type="required"></dxi-validation-rule>
              <dxo-label [visible]="false"></dxo-label>
            </dxi-item>

            <dxi-item [editorOptions]="{ stylingMode: 'filled', placeholder: 'ClinicId' }" dataField="clinicId" editorType="dxTextBox">
              <dxi-validation-rule message="ClinicId is required" type="required"></dxi-validation-rule>
              <dxo-label [visible]="false"></dxo-label>
            </dxi-item>

            <dxi-item itemType="button">
              <dxo-button-options
                [text]="'Update Doctor'"
                [useSubmitBehavior]="true"
                type="default"
                width="100%"
              >
              </dxo-button-options>
            </dxi-item>
          </dx-form>
        </form>

      </div>
    </dx-popup>

  </div>
</div>
